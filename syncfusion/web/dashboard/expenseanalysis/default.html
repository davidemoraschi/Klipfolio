<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Essential Studio for JavaScript : Expense Analysis</title>
   <link href="../../themes/bootstrap.min.css" rel="stylesheet" />
	<link href="../../themes/default-theme/ej.widgets.all.min.css" rel="stylesheet" />
	<link rel="shortcut icon" href="../../themes/images/favicon.ico">
    <link href="css/expense-css.css" rel="stylesheet" />
    <link href="../../themes/responsive-css/ej.responsive.css" rel="stylesheet" />
    <!--[if lt IE 9]>
	<script src="../../scripts/jquery-1.11.3.min.js" type="text/javascript" ></script> 
	<![endif]-->
	<!--[if IE 9]><!-->
	<script src="../../scripts/jquery-2.1.4.min.js" type="text/javascript"> </script>
	<!--<![endif]-->
    <script src="../../scripts/jquery.easing.1.3.min.js"></script>
    <script src="../../scripts/jquery.globalize.min.js"></script>
	<script src="../../scripts/jquery.validate.min.js"></script>
    <script src="../../scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="../../scripts/jsrender.min.js"></script>
    <script src="../../scripts/ej.web.all.min.js"></script>    
</head>
<body>
    <div class="sample-title">
    </div>
    <div class="container">
        <div class="sample-container">
            <div id="control-container">
                <div class="text-title">
                </div>
                <div class="row imagetile">                    
                           <div class="col-md-5">
						   <table>
						   <tr>
						   <td>
                                <div class="left-image">
                                </div>
								</td>
								<td>
                            <div style="horz-align:right;">
                                <div class="e-title">
                                    <label class="e-name">
                                        David Carter</label><br />
                                    <label class="e-phone">
                                        Phone : +1 919.494.1974
                                    </label>
                                    <br />
                                    <label class="e-mail">
                                        email : davidc@syncfusion.com</label>
                                </div>
                            </div>
							</td>
							</tr>
							</table>
							</div>
                            <div class="col-md-7 e-values-td">
							<div class="initborder">
                                <table class="e-values">
                                    <tr >
                                        <td class="pos-amt-td sideborder">
                                            <p class="pos-amt"></p>
                                            <p class="pos-text">
                                                Positive
                                            </p>
                                            <p class="pos-transc">
                                            </p>
                                        </td>
                                        <td class="neg-amt-td sideborder">
                                            <p class="neg-amt"></p>
                                            <p class="neg-text">
                                                Negative
                                            </p>
                                            <p class="neg-transc"></p>
                                        </td>
                                        <td class="bal-amt-td">
                                            <p class="bal-amt"></p>
                                            <p class="bal-text">
                                                Balance
                                            </p>
                                            <p class="bal-empty" style="visibility: hidden">
                                                Transaction
                                            </p>
                                        </td>
                                    </tr>
                                </table>
								</div>
                            </div>
                        
                    </div>
                
                <div class="chartgridtable">				
				<div  id="control-panel" class="add-filter-panel">
                    <div class="row">
                          <div class="col-md-1" style="DISPLAY: inline" >
                                  <label class="sample-t">
                                        Transactions</label>
                                </div>
								 <div class="col-md-8" style="DISPLAY: inline" ></div>
                                <div class="col-md-2" style="DISPLAY: inline;">
								<table style="float:left;">
								<tr>
								<td>
                                    <div >
                                        <input type="text" id="selectMonth" />
                                        <div id="MonthList">
                                            <ul>
                                                <li>All</li>
                                                <li>January</li>
                                                <li>February</li>
                                                <li>March</li>
                                                <li>April</li>
                                                <li>May</li>
                                                <li>June</li>
                                                <li>July</li>
                                                <li>August</li>
                                                <li>September</li>
                                                <li>October</li>
                                                <li>November</li>
                                                <li>December</li>
                                            </ul>
                                        </div>
                                    </div>
									</td>
									<td>
                                    <div class="add-image">
                                    </td>
									</tr>
									</table>
                                </div>
                                
                                
                            
                        </div>
                    </div>
					<div class="expensegridborder">
                    <div  class="col-xs-13 grid-container">
                        <div id="ExpenseGrid">
                        </div>
                    </div>
					</div>
                    <div class="chart-container">
                        <div class="chart-inner">
                            <div class="samplesec">
                                <div >
                                    <div class="samplename">
                                        <span> Expense Analysis Chart </span>
                                    </div>
                                    <div class="samplebody">
                                        <div class="samplecontent">
                                          
                                                        <div class="chart-back-button">
                                                            <button id="btnBack">Back</button>
                                                        </div>
														<div style="margin-top:30px;"  class="row">
                                                        <div class="col-md-8">
                                                            <div style="margin-top:-10px;" id="ExpenseChart">
                                                            </div>
                                                        </div>														
                                                        <div class="col-md-3">														
                                                            <div class="spend-div">
                                                                <table cellspacing="10">
                                                                    <tr>
                                                                        <td class="most-spent">
                                                                            <p class="most-spent-text">
                                                                                Most Spent
                                                                            </p>
                                                                            <p class="most-spent-amt">
                                                                            </p>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td class="least-spent">
                                                                            <p class="least-spent-text">
                                                                                Least Spent
                                                                            </p>
                                                                            <p class="least-spent-amt">
                                                                            </p>
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td class="avg-spent">
                                                                            <p class="avg-spent-text">
                                                                                Average Spent
                                                                            </p>
                                                                            <p class="avg-spent-amt">
                                                                            </p>
                                                                        </td>
                                                                    </tr>
                                                                </table>
                                                            </div>
                                                        </div>
														
														</div>
                                                   
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
				</div>
            </div>
			</div>
        </div>
    </div>
    <script type="text/javascript">
        $(function () {
            $('#selectMonth').ejDropDownList({
                targetID: "MonthList",
                width: "150px",
                height: "30px",
                select: "changeMonth"
            });
            $('#selectMonth').data("ejDropDownList").setSelectedText("January");
            $("#btnBack").ejButton({
                size: "mini",
                click: "btnClick"
            });
            $("#btnBack").hide();
			  //For IE 8 Layout
			var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");
		 if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)){
		if(parseInt(ua.substring(msie + 5, ua.indexOf(".", msie))) == 8)
		$(".col-md-2").css("float","right");
		$(".col-md-3").css("width","25%");
		$(".col-md-3").css("float","right");
		$(".col-md-8").css("display","inline-block");
		$(".col-md-8").css("width","60%");
		$(".col-md-5").css("display","inline-block");
		$(".col-md-7").css("padding-left","149px");
		$(".col-md-7").css("display","inline-block");
		}
        });
        function changeMonth(sender) {
            $(".add-filter-panel").ejWaitingPopup();
            $(".add-filter-panel").ejWaitingPopup("show");
            UpdateGridChart(sender.selectedText); //updating content of grid and chart on change of month
        }

        $(document).on("click", ".add-image", function () {
            var gridObj = $("#ExpenseGrid").ejGrid("instance");
            gridObj.addRecord(); //adding new record in grid 
        });
        // Updating the grid and chart contents
        function UpdateGridChart(month) {
            // Getting json data from web api
            var dataManger = ej.DataManager({
                url: "http://mvc.syncfusion.com/Services/api/expense?month=" + month,
                offline: true,
                requiresFormat : false
            });

            dataManger.ready.done(function (e) {
                if ($("#ExpenseGrid").data("ejGrid"))
                    $("#ExpenseGrid").ejGrid("destroy");
                $("#ExpenseGrid").ejGrid({
                    dataSource: e.result[1],
                    allowPaging: true,
                    allowSorting: true,
                    enableRowHover: false,
                    dataBound: completeAction,
                    allowKeyboardNavigation: true,
                    editSettings: { allowEditing: false, allowAdding: true, editMode: ej.Grid.EditMode.Dialog },
                    cssClass: "metroblue",
					pageSettings: { pageCount: 4 },
                    columns: [
                    { field: "DateTime",headerText: 'Date', textAlign: ej.TextAlign.Right, width: 40,validationRules: { required: true }, format: "{0:MMM dd yyyy}", editType: ej.Grid.EditingType.DatePicker },
                    { field: "CategoryName", headerText: 'CategoryName', validationRules: { required: true, minlength: 3 }, width: 100, visible: false },
                    { field: "Description", headerText: 'Description',validationRules: { required: true, minlength: 3}, width: 100 },
                    { field: "SubCategory", headerText: 'Category', validationRules: { required: true, minlength: 3},width: 70 },
                    { field: "Amount", headerText: 'Amount', validationRules: { required: true},textAlign: ej.TextAlign.Right, editType: ej.Grid.EditingType.Numeric,editParams: { decimalPlaces: 2, minValue:0 }, format: "{0:C}", width: 50 }
                    ]
                });
                if ($("#ExpenseChart").data("ejChart"))
                    $("#ExpenseChart").ejChart("destroy");
                $("#ExpenseChart").ejChart(
                        {
						    canResize:true,
                            
                            series: [{
                                type: 'pie',
                                name: "ExpenseChart",
                                enableAnimation: true,
                                labelPosition: 'outside',
                                marker: {connectorLine : {height:20}, dataLabel:{visible:true,} },
                                border: {width: 1 },
                                explode: true,
                                dataSource: e.result[0],
								xName: "ExpenseCategory", 
								yName: "Amount"
								
                            }
                            ],
                            pointRegionClick: 'onclick',
                            animationComplete: 'completeAnimation',
                            seriesRendering: "seriesRender",
							loaded:'chartLoaded',
                            background: 'transparent',
                            enableSmartLabels:true,
                            legend: { visible: false },
                        });
                $('.pos-amt').html("$" + formatNumber(parseInt(e.result[5])));
                $('.neg-amt').html("$" + formatNumber(parseInt(e.result[6])));
                $('.bal-amt').html("$" + formatNumber(parseInt(e.result[7])));
                $('.most-spent-amt').html(e.result[2]);
                $('.least-spent-amt').html(e.result[3]);
                $('.avg-spent-amt').html(e.result[4]);
                $('.pos-transc').html(e.result[8] + " Transactions");
                $('.neg-transc').html(e.result[9] + " Transactions");
                window.chartDS = e.result[0];
                window.Home = e.result[10]
                window.DailyLiving = e.result[11]
                window.Entertainment = e.result[12]
                window.Health = e.result[13]
                window.Transportation = e.result[14]
                window.Personal = e.result[15]
                $(".add-filter-panel").ejWaitingPopup("hide");
            });

        }
        function completeAction(sender) {
             $('#ExpenseGrid_dialogEdit').ejDialog({showOnInit:false, width: "auto",position: { X: 500, Y: 200 } ,allowKeyboardNavigation: false });
        }
        function formatNumber(number) {
            return Globalize.format(number, "n0"); //formating numbers  for spent amounts
        }
		//function chartLoaded(sender){
		//sender.model.series[0].animation=false ;
		//}
        function seriesRender(e) {
            //Adding text to the series points to chart
            $.each(e.data.series.points, function () {
                this.text = this.x + "- $" + formatNumber(parseInt((this.YValues)));
            });
	    if (Math.abs(e.model.m_AreaBounds.Width-e.model.m_AreaBounds.Height)< 50 )
			  e.data.series.pieCoefficient = 0.3;
		 if (Math.abs(e.model.m_AreaBounds.Width-e.model.m_AreaBounds.Height)< 100 )
			  e.data.series.pieCoefficient = 0.4;
		 else if(Math.abs(e.model.m_AreaBounds.Width-e.model.m_AreaBounds.Height)< 150 )
			  e.data.series.pieCoefficient = 0.5;
		 else if(Math.abs(e.model.m_AreaBounds.Width-e.model.m_AreaBounds.Height)< 200 )
			  e.data.series.pieCoefficient = 0.6;
		 else
			  e.data.series.pieCoefficient = 0.8;
        }
        function btnClick(sender) {
            $("#ExpenseChart").ejChart("option", { "pie": pieSeries() });
            $("#btnBack").hide();
        }
        function onclick(sender) {
            {
                //Rendering drilldown dhart based on the points clicked
                if (sender.model.AnimationComplete) {
                    var index = sender.data.region.Region.PointIndex;
                    var name = sender.model.series[0].points[index].x;
                    if (sender.model.series[0].name == "ExpenseChart")
                        $("#ExpenseChart").ejChart("option", { "drilldown": pieSeries(name) });
                }
            }
        }
        function completeAnimation(sender) {
            //show or hide back button based on the series name
            if (sender.model.series[0].name != "ExpenseChart")
                $("#btnBack").show();
            else
                $("#btnBack").hide();
        }

        function pieSeries(seriesName) {
            //Choosing the series points based on the series name to drilldown chart
            switch (seriesName) {
                case "Home":
                    {
                        return {
                            series: [{
                                dataSource: window.Home,
								xName: "ExpenseCategory",
								yName: "Amount" ,
								type: 'pie',
                                labelPosition: 'outside',
								pieCoefficient : 0.4,
                                enableAnimation: true,
                                explode: false,
								marker:{
								dataLabel:{
								visible:true, 
								shape:'none',
								connectorLine: { color: 'black', width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                               
                            }],
                            legend: { visible: false },
                        };
                    }
                    break;
                case "Entertainment":
                    {
                        window.Entertainment[1].Amount = 45;
                        return {
                            series: [{
                                dataSource: window.Entertainment, 
								xName: "ExpenseCategory", 
								yName: "Amount" ,
							     type: 'pie',
                                labelPosition: 'outside',
								pieCoefficient : 0.4,
                                enableAnimation: true,
                                explode: false,
                                marker:{
								dataLabel:{
								visible:true, 
								shape:'none',
								connectorLine: { color: 'black', width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                            }],
                            legend: { visible: false },
                        };
                    }
                    break;
                case "Daily Living":
                    {
                        return {
                            series: [{
                                dataSource: window.DailyLiving,
								xName: "ExpenseCategory", 
								yName: "Amount",
								type: 'pie',
                                labelPosition: 'outside',
								pieCoefficient : 0.4,
                                explode: false,
                                enableAnimation: true,
                                marker:{
								dataLabel:{
								visible:true, 
								shape:'none', 
								connectorLine: { color: 'black', width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                            }],
                            legend: { visible: false },
                        };
                    }
                    break;
                case "Health":
                    {
                        return {
                            series: [{
                                dataSource:  window.Health,
								xName: "ExpenseCategory",
								yName: ["Amount"],
								type: 'pie',
                                labelPosition: 'outside',
								pieCoefficient : 0.4,
                                explode: false,
                                enableAnimation: true,
                               marker:{
								dataLabel:{
								visible:true,
								shape:'none',
								connectorLine: { color: 'black', width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                            }],
                            legend: { visible: false },
                        };
                    }
                    break;
                case "Transportation":
                    {
                        return {
                            series: [{
                                dataSource: window.Transportation,
								xName: "ExpenseCategory",
								yName: ["Amount"],
								type: 'pie',
                                labelPosition: 'outside',
                                explode: false,
								pieCoefficient : 0.4,
                                enableAnimation: true,
                                marker:{
								dataLabel:{
								visible:true,
								shape:'none',
								connectorLine: { color: 'black', width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                            }],
                            legend: { visible: false },
                        };
                    }
                    break;
                case "Personal":
                    {
                        return {
                            series: [{
                                dataSource: window.Personal,
								xName: "ExpenseCategory",
								yName: "Amount",
								type: 'pie',
                                labelPosition: 'outside',
                                explode: false,
								pieCoefficient : 0.4,
                                enableAnimation: true,
                                marker:{
								dataLabel:{
								visible:true,
								shape:'none', 
								connectorLine: { color: 'black', width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                            }],
                            legend: { visible: false },
                        };
                    }
                    break;
                default:
                    {
                        return {
                            series: [{
                                name: "ExpenseChart",
                                dataSource: window.chartDS,
								xName: "ExpenseCategory", 
								yName: "Amount",
								type: 'pie',
                                labelPosition: 'outside',
								pieCoefficient : 0.4,
                                explode: true,
								explodeOffset:25,
                                enableAnimation: true,
								AnimationComplete: false,
                               marker:{
								dataLabel:{
								visible:true,
								shape:'none',
								connectorLine: { color:null, width: 0.5 },
								font: { fontFamily: 'Segoe UI', fontStyle: 'Normal ', fontWeight: 'Regular', size: '12px', color: '#707070', opacity: 1 }}
								}
                            }],
                            legend: { visible: false },
                            AnimationComplete: false
                        };
                    }
            }

        }
    </script>
</body>
</html>
